<?php

/*
 * @file 
 * User interface tweaks and other modifications for the Stanford Sites platform
 */

/**
 * Implementation of hook_theme_registry_alter().
 */
function stanford_sites_helper_theme_registry_alter(&$theme_registry) {
  $theme_registry['box']['function'] = 'stanford_sites_helper_box'; 
  $theme_registry['box']['path'] = drupal_get_path('module', 'stanford_sites_helper');
}

/**
 * Override of search#noresults.
 * See hook_help() in search.module.
 */
function stanford_sites_helper_box($title, $content, $region = 'main') {
  if ($title == 'Your search yielded no results') {
    $content = '<ul>';
    $content .= '<li>'. t('Check if your spelling is correct.') .'</li>';
    $content .= '<li>'. t('Simplify your search by using fewer words.') .'</li>';
    $content .= '<li>'. t('Remove quotes around phrases to match each word individually: %stanfordquote will match less than %stanfordnoquote.', array('%stanfordquote' => '"stanford university"', '%stanfordnoquote' => 'stanford university')) .'</li>';
    $content .= '<li>'. t('Consider loosening your query with <em>OR</em>: <em>stanford university</em> will match less than <em>stanford OR university</em>.') .'</li>';
    $content .= '</ul>';
  }
  $output = '<h2 class="title">'. $title .'</h2><div>'. $content .'</div>';
  return $output;
}

/**
* Implementation of hook_block().
*/
function stanford_sites_helper_block($op = 'list', $delta = 0) {
  $block = array();
  switch ($op) {
    case 'list':
      $blocks['helplinks']['info'] = t('Display a list of help links specific to Stanford Sites');
      $blocks['helplinks']['status'] = 1;
      $blocks['helplinks']['region'] = 'header';
      $blocks['helplinks']['visibility'] = 1;
      $blocks['helplinks']['pages'] = "admin\nadmin/*";
      return $blocks;
    case 'view':
      switch ($delta) {
        case 'helplinks':
          $block['subject'] = t('Get Help');
          $block['content'] = t('Problems using this service? Submit a !helpsu.', array('!helpsu' => l('HelpSU request', 'http://remedyweb.stanford.edu/helpsu/2.0/helpsu-form?pcat=webdesign')));
          break;
        }
      return $block;
  }
}

/*
 * Fix spell check as you type (scayt) autostart behavior.
 * See http://drupal.org/node/817894 for reference.
 */
function stanford_sites_helper_wysiwyg_editor_settings_alter(&$settings, $context) {
  if ($context['profile']->editor == 'ckeditor') {
    $settings['scayt_autoStartup'] = FALSE;
  }
}
